"use strict";var app=angular.module("retrofire",["firebase","angular-md5","ui.bootstrap","ui.router","ngTable","ngTagsInput","textAngular"]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("home",{url:"/",resolve:{requireNoAuth:["$state","Auth",function(a,b){return b.$requireAuth().then(function(b){a.go("dashboard")},function(b){a.go("login")})}]}}).state("login",{url:"/login",controller:"AuthCtrl as authCtrl",templateUrl:"auth/login.html",resolve:{requireNoAuth:["$state","Auth",function(a,b){return b.$requireAuth().then(function(b){a.go("dashboard")},function(a){})}]}}).state("password-reset",{url:"/password-reset",controller:"AuthCtrl as authCtrl",templateUrl:"auth/password-reset.html",resolve:{requireNoAuth:["$state","Auth",function(a,b){return b.$requireAuth().then(function(b){a.go("dashboard")},function(a){})}]}}).state("about",{url:"/about",templateUrl:"static/about.html"}).state("profile",{url:"/profile",controller:"ProfileCtrl as profileCtrl",templateUrl:"users/profile.html",resolve:{auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}],profile:["Users","Auth",function(a,b){return b.$requireAuth().then(function(b){return a.getProfile(b.uid).$loaded()})}]}}).state("dashboard",{url:"/dashboard",controller:"DashboardCtrl as dashboardCtrl",templateUrl:"dashboard/index.html",resolve:{auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("login")})}],dashboard:["Users","Auth",function(a,b){return b.$requireAuth().then(function(b){return a.getProfile(b.uid).$loaded()})}]}}).state("directory",{url:"/directory",controller:"DirectoryCtrl as directoryCtrl",templateUrl:"directory/index.html",resolve:{auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("login")})}],dashboard:["Users","Auth",function(a,b){return b.$requireAuth().then(function(b){return a.getProfile(b.uid).$loaded()})}]}}).state("directory/user",{url:"/directory/user/{userId}",templateUrl:"directory/view.html",controller:"DirectoryCtrl as directoryCtrl"}).state("questions",{url:"/questions",controller:"QuestionsCtrl as questionsCtrl",templateUrl:"questions/index.html",resolve:{questions:["Questions",function(a){return a()}]}}).state("questions/create",{url:"/questions/create",templateUrl:"questions/create.html",controller:"QuestionsCtrl as questionsCtrl"}).state("questions/edit",{url:"/questions/edit/{questionId}",templateUrl:"questions/edit.html",controller:"QuestionsCtrl as questionsCtrl"}).state("questions/view",{url:"/questions/{questionId}",templateUrl:"questions/view.html",controller:"QuestionsCtrl as questionsCtrl"}).state("ideas",{url:"/ideas",controller:"IdeasCtrl as ideasCtrl",templateUrl:"ideas/index.html",resolve:{ideas:["Ideas",function(a){return a()}],auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}]}}).state("ideas/create",{url:"/ideas/create",templateUrl:"ideas/create.html",controller:"IdeasCtrl as ideasCtrl",resolve:{auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}]}}).state("ideas/edit",{url:"/ideas/edit/{ideaId}",templateUrl:"ideas/edit.html",controller:"IdeasCtrl as ideasCtrl",resolve:{auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}]}}).state("ideas/view",{url:"/ideas/view/{ideaId}",templateUrl:"ideas/view.html",controller:"IdeasCtrl as ideasCtrl",resolve:{auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}]}}).state("memos",{url:"/memos",templateUrl:"memos/index.html",controller:"MemosCtrl as memosCtrl",resolve:{requests:["Memos",function(a){return a()}],auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}]}}).state("memos/create",{url:"/memos/create",templateUrl:"memos/create.html",controller:"MemosCtrl as memosCtrl",resolve:{auth:["$state","Users","Auth",function(a,b,c){return c.$requireAuth()["catch"](function(){a.go("home")})}]}}).state("memos/view",{url:"/memos/view/{memoId}",templateUrl:"memos/view.html",controller:"MemosCtrl as memosCtrl"}).state("memos/edit",{url:"/memos/edit/{memoId}",templateUrl:"memos/edit.html",controller:"MemosCtrl as memosCtrl"}),b.otherwise("/")}]).constant("FIREBASE_URL","https://ss16-retrofire.firebaseio.com/");console.log("--> retrofire/app/app.js loaded"),app.factory("Auth",["$firebaseAuth","FIREBASE_URL",function(a,b){var c=new Firebase(b),d=a(c);return d}]),console.log("--> retrofire/app/auth/auth.service.js loaded"),app.controller("AuthCtrl",["FIREBASE_URL","Auth","$state","$scope","$rootScope",function(a,b,c,d,e){var f=new Firebase(a),g=this;g.user={email:"",password:""},g.login=function(){b.$authWithPassword(g.user).then(function(a){console.log("Logged in as: ",a.uid),c.go("dashboard")},function(a){g.error=a})},g.resetPassword=function(){f.resetPassword({email:g.user.email},function(a){null===a?console.log("Password reset email sent successfully"):console.log("Error sending password reset email:",a)})}}]),console.log("--> retrofire/app/auth/auth.controller.js loaded"),app.factory("Users",["$firebaseArray","$firebaseObject","FIREBASE_URL",function(a,b,c){var d=new Firebase(c+"users"),e=new Firebase(c+".info/connected"),f=a(d),g={getProfile:function(a){return b(d.child(a))},getEmail:function(a){return f.$getRecord(a).email},getDisplayName:function(a){return null!=f.$getRecord(a)?f.$getRecord(a).displayName:"Unknown User"},getGravatar:function(a){return"//www.gravatar.com/avatar/"+f.$getRecord(a).emailHash},setOnline:function(c){var f=b(e),g=a(d.child(c+"/online"));f.$watch(function(){f.$value===!0&&g.$add(!0).then(function(a){a.onDisconnect().remove()})})},all:f};return g}]),console.log("--> retrofire/app/users/users.service.js loaded"),app.service("User",["FIREBASE_URL","$firebaseAuth","Users",function(a,b,c){var d=this,e=new Firebase(a),f=b(e),g={uid:"",email:""};d.getId=function(){return g.uid},d.getEmail=function(){return g.email},f.$onAuth(function(a){return a?(console.log("[user service] authenticated User is logged in as:",a.uid),g.uid=a.uid,g.email=a.password.email,g):(console.log("[user service] authenticated user Logged out"),g={uid:"",email:""},console.log("[user service] returned user:",g),g)})}]),console.log("--> retrofire/app/user.service.js loaded"),app.controller("ProfileCtrl",["FIREBASE_URL","$state","Auth","md5","auth","profile","User","Users",function(a,b,c,d,e,f,g,h){var i=new Firebase(a),j=this;j.profile=f,j.updateProfile=function(){j.profile.email=e.password.email,j.profile.emailHash=d.createHash(e.password.email),j.profile.$save().then(function(){b.go("dashboard")})},j.logout=function(){j.profile.online=null,j.profile.$save().then(function(){c.$unauth(),b.go("login")})},j.changePassword=function(){i.changePassword({email:j.profile.email,oldPassword:j.profile.currentPassword,newPassword:j.profile.newPassword},function(a){null===a?console.log("Password changed successfully"):console.log("Error changing password:",a)})}}]),console.log("--> retrofire/app/users.profile.js loaded"),app.controller("NavbarCtrl",["$scope","$state","$firebaseAuth","FIREBASE_URL","Users",function(a,b,c,d,e){var f=new Firebase(d);a.authObj=c(f),a.loggedin=!1,a.authObj.$onAuth(function(b){b?(console.log("[onAuth] Logged in as:",b.uid),a.userObj=e.getProfile(b.uid),a.loggedin=!0,console.log(a.userObj),console.log("User logged in: ",a.loggedin)):(console.log("[onAuth] Logged out"),a.userObj={},a.loggedin=!1,console.log(a.userObj),console.log("User logged in: ",a.loggedin))}),a.logout=function(){a.authObj.$unauth(),console.log("[unauth] Logged out"),b.go("login")}}]),console.log("--> retrofire/app/navbar/navbar.controller.js loaded"),app.controller("DashboardCtrl",["$state","md5","auth",function(a,b,c){}]),console.log("--> retrofire/app/dashboard/dashboard.controller.js loaded"),app.controller("DirectoryCtrl",["$state","$scope","FIREBASE_URL","$firebaseObject","$firebaseArray","$stateParams","ngTableParams","$filter","Users",function(a,b,c,d,e,f,g,h,i){var j=new Firebase(c+"users");b.users=e(j),b.getUser=function(){var a=new Firebase(c+"users");b.user=d(a.child(f.userId))},b.users.$loaded().then(function(a){console.log(a.length);var c=a;b.tableDirectory=new g({page:1,count:10,sorting:{title:"asc"}},{total:c.length,getData:function(a,b){var d=b.sorting()?h("filter")(c,b.filter()):c;a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}})});var k=new Firebase(c+"users"),l=e(k);l.$watch(function(a){console.log(a),b.users.$loaded().then(function(){b.tableDirectory.reload()})})}]),console.log("--> retrofire/app/directory.controller.js loaded");var deleteFromArray=function(a,b){for(var c=a.indexOf(b);-1!==c;)a.splice(c,1),c=a.indexOf(b)},indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};app.controller("QuestionsCtrl",["$state","$scope","FIREBASE_URL","$firebaseObject","$firebaseArray","$stateParams","ngTableParams","$filter","User","Users","Questions",function(a,b,c,d,e,f,g,h,i,j,k){b.questions=k(),b.user=i,b.users=j,b.create=function(){b.questions.$add({userId:b.question.userId||i.getId(),content:b.question.content,tags:b.question.tags||["tomcat","hadoop","node.js"],views:0,createdAt:Firebase.ServerValue.TIMESTAMP}).then(function(){console.log("question Created"),a.go("questions")})["catch"](function(a){console.log(a)})},b["delete"]=function(a){b.questions.$remove(a).then(function(){console.log("question Deleted")})["catch"](function(a){console.log(a)})},b.getQuestion=function(){var a=new Firebase(c+"questions"),e=a.child(f.questionId);b.question=d(e),e.child("views").transaction(function(a){return(a||0)+1})},b.update=function(c){b.question.updatedAt=Firebase.ServerValue.TIMESTAMP,b.question.$save().then(function(){console.log("question Updated"),null!=c&&a.go(c)})["catch"](function(a){console.log(a)})},b.upVote=function(a){var a=a||b.question;a.upvotes||(a.upvotes=[]),a.downvotes||(a.downvotes=[]),indexOf.call(a.upvotes,i.getId())>=0?(console.log("Removing vote"),deleteFromArray(a.upvotes,i.getId())):(console.log("Casting vote for "+i.getId()),a.upvotes.push(i.getId()),deleteFromArray(a.downvotes,i.getId())),a.votes=a.upvotes.length+a.downvotes.length,b.update()},b.downVote=function(a){var a=a||b.question;a.upvotes||(a.upvotes=[]),a.downvotes||(a.downvotes=[]),indexOf.call(a.downvotes,i.getId())>=0?(console.log("Removing vote"),deleteFromArray(a.downvotes,i.getId())):(console.log("Casting vote for "+i.getId()),a.downvotes.push(i.getId()),deleteFromArray(a.upvotes,i.getId())),a.votes=a.upvotes.length+a.downvotes.length,b.update()},b.questions.$loaded().then(function(a){console.log(a.length);var c=a;b.tablequestions=new g({page:1,count:10,sorting:{name:"asc"}},{total:c.length,getData:function(a,b){var d=b.sorting()?h("filter")(c,b.filter()):c;a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}})});var l=new Firebase(c+"questions"),m=e(l);m.$watch(function(a){console.log(a),b.questions.$loaded().then(function(){b.tablequestions.reload()})})}]),console.log("--> questions.controller.js loaded"),app.factory("Questions",["FIREBASE_URL","$firebaseArray",function(a,b){return function(){var c=new Firebase(a+"questions");return b(c)}}]),console.log("--> questions.service.js loaded"),app.controller("IdeasCtrl",["$state","$scope","FIREBASE_URL","$firebaseObject","$firebaseArray","$stateParams","ngTableParams","$filter","User","Users","Ideas",function(a,b,c,d,e,f,g,h,i,j,k){b.ideas=k(),b.user=i,b.users=j,b.create=function(){b.ideas.$add({name:b.idea.name,description:b.idea.description,comments:["testing"],createdAt:(new Date).toString(),views:0,userId:i.getId()}).then(function(){console.log("idea Created"),a.go("ideas")})["catch"](function(a){console.log(a)})},b["delete"]=function(a){b.ideas.$remove(a).then(function(){console.log("idea Deleted")})["catch"](function(a){console.log(a)})},b.getIdea=function(){var a,e=new Firebase(c+"ideas");b.idea=d(e.child(f.ideaId)),e.child(f.ideaId).once("value",function(b){a=b.val();var c=a.views,d=c+1,g=e.child(f.ideaId);g.update({views:d})})},b.update=function(){b.idea.$save().then(function(){console.log("idea Updated"),a.go("ideas")})["catch"](function(a){console.log(a)})},b.addComment=function(){"testing"===b.idea.comments[0]&&(b.idea.comments=[]);var a={content:b.content,userId:i.getId(),createdAt:(new Date).toString()};b.idea.comments.push(a);var d=new Firebase(c+"ideas"),e=d.child(f.ideaId);e.update({comments:b.idea.comments}),b.tableIdeas.reload()},b.ideas.$loaded().then(function(a){console.log(a.length);var c=a;b.tableIdeas=new g({page:1,count:10,sorting:{name:"asc"}},{total:c.length,getData:function(a,b){var d=b.sorting()?h("filter")(c,b.filter()):c;a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}})});var l=new Firebase(c+"ideas"),m=e(l);m.$watch(function(a){console.log(a),b.ideas.$loaded().then(function(){b.tableIdeas.reload()})})}]),console.log("--> retrofire/app/devices/ideas.controller.js loaded"),app.factory("Ideas",["FIREBASE_URL","$firebaseArray",function(a,b){return function(){var c=new Firebase(a+"ideas");return b(c)}}]),console.log("--> retrofire/app/ideas/ideas.service.js loaded"),app.controller("MemosCtrl",["$state","$scope","FIREBASE_URL","$firebaseObject","$firebaseArray","$stateParams","ngTableParams","$filter","Memos","User",function(a,b,c,d,e,f,g,h,i,j){b.memos=i(),b.create=function(c){c.createdAt=(new Date).toString(),c.createdBy=j.getEmail(),c.createdById=j.getId(),c.views=1,b.memos.$add(c).then(function(){console.log("[ MemosCtrl ] --> Memo Created"),a.go("memos")})["catch"](function(a){console.log(a)})},b.getMemo=function(){var a,e=new Firebase(c+"memos");b.memo=d(e.child(f.memoId)),e.child(f.memoId).once("value",function(b){a=b.val();var c=a.views,d=c+1,g=e.child(f.memoId);g.update({views:d})})},b.update=function(){b.memo.$save().then(function(){console.log("[ MemosCtrl ] --> Memo Updated"),a.go("memos")})["catch"](function(a){console.log(a)})},b["delete"]=function(c){b.memos.$remove(c).then(function(){console.log("[ MemosCtrl ] --> Memo Deleted"),a.go("memos")})["catch"](function(a){console.log(a)})},b.memos.$loaded().then(function(a){console.log(a.length);var c=a;b.tableMemos=new g({page:1,count:10,sorting:{title:"asc"}},{total:c.length,getData:function(a,b){var d=b.sorting()?h("filter")(c,b.filter()):c;a.resolve(d.slice((b.page()-1)*b.count(),b.page()*b.count()))}})});var k=new Firebase(c+"memos"),l=e(k);l.$watch(function(a){console.log(a),b.memos.$loaded().then(function(){b.tableMemos.reload()})})}]),console.log("--> retrofire/app/memos/memos.controller.js loaded"),app.factory("Memos",["FIREBASE_URL","$firebaseArray",function(a,b){return function(){var c=new Firebase(a+"memos");return b(c)}}]),console.log("--> retrofire/app/memos/memos.service.js loaded");